<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Becoffee | Menu</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="site/styles.css" />
</head>

<body>
  <header class="header">
    <div class="container">
      <div class="nav-left">
        <a href="/">Home</a>
        <a href="/menu">Menu</a>
        <a href="/gallery">Gallery</a>
      </div>

      <div class="logo">
        <a href="/">
          <img src="https://themes.muffingroup.com/be/coffee/wp-content/uploads/2015/01/retina-coffee.png"
            alt="Becoffee Logo" />
        </a>
      </div>

      <div class="nav-right">
        <a href="/contact">Contact</a>
        <a href="/cart" class="cart-link">
          Cart <span class="cart-badge" style="display:none;">0</span>
        </a>
        <a href="/login" id="userBadge">Login</a>
      </div>
    </div>
  </header>

  <main>
    <section class="py-5 container">

      
      <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
        <div>
          <h2>Our Menu</h2>
          <p class="text-muted mb-0">Freshly brewed and ready to order.</p>
        </div>

        <div class="d-flex mt-2 mt-md-0">
          
          <select id="categoryFilter" class="form-select w-auto me-2">
            <option value="all">All Categories</option>
          </select>

          
          <select id="priceFilter" class="form-select w-auto">
            <option value="all">All Prices</option>
            <option value="0-5">Under $5</option>
            <option value="5-10">$5 - $10</option>
            <option value="10-20">$10 - $20</option>
            <option value="20+">Above $20</option>
          </select>
        </div>
      </div>

      
      <div id="products" class="product-grid"></div>

    </section>
  </main>


  <footer>
    <div class="row">
      <div class="le">
        <h9>Bibendum auctor</h9>
        <p>
          Sed ut imperdiet nisi. Proin condimentum fermentum nunc. Etiam pharetra, erat sed fermentum feugiat, velit
          mauris egestas quam, ut aliquam massa nisl quis neque.
        </p>
      </div>
      <div class="mi">
        <h9>Aliquam erat</h9>
        <p>
          Proin gravida nibh vel velit auctor aliquet. Aenean sollicitudin, lorem quis bibendum auctor, nisi elit
          consequat ipsum, nec sagittis sem nibh id elit. Duis sed odio sit amet.
        </p>
      </div>
      <div class="ri">
        <h9>Nullam wisi</h9>
        <p>
          Nullam viverra consectetuer. Quisque cursus et, porttitor risus. Aliquam sem. In hendrerit nulla quam nunc,
          accumsan congue. Lorem ipsum primis in nibh vel risus. Sed vel lectus.
        </p>
      </div>
    </div>







    <script src="site/app.js"></script>

    <script>
      ensureAuthOrRedirect();

      let allProducts = [];

      // ✅ Load categories from backend
      async function loadCategories() {
        const filter = document.getElementById('categoryFilter');

        try {
          const categories = await api('/categories');

          filter.innerHTML = '<option value="all">All Categories</option>';

          categories.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat.name;
            option.textContent = cat.name;
            filter.appendChild(option);
          });
        } catch (err) {
          console.error('Category load error:', err);
        }
      }

      // ✅ Load products
      async function loadProducts() {
        const container = document.getElementById('products');
        container.innerHTML = '<p>Loading products...</p>';

        try {
          allProducts = await api('/products');
          renderProducts(allProducts);
        } catch (err) {
          container.innerHTML = `<p class="text-danger">${err.message}</p>`;
        }
      }

      // ✅ Render products
      function renderProducts(products) {
        const container = document.getElementById('products');

        if (products.length === 0) {
          container.innerHTML = '<p class="text-muted">No products found.</p>';
          return;
        }

        container.innerHTML = products.map(p => `
      <div class="product-card">
        <img src="${p.image}" alt="${p.name}" />
        <h5>${p.name}</h5>
        <p class="text-muted small">${p.description}</p>

        <div class="d-flex justify-content-between align-items-center">
          <span class="fw-bold">$${p.price.toFixed(2)}</span>
        </div>
      </div>
    `).join('');
      }

      // ✅ Apply both filters
      function applyFilters() {
        const category = document.getElementById('categoryFilter').value;
        const price = document.getElementById('priceFilter').value;

        let filtered = allProducts;

        // Filter by category
        if (category !== 'all') {
          filtered = filtered.filter(p => p.category === category);
        }

        // Filter by price
        if (price !== 'all') {
          filtered = filtered.filter(p => {
            const pr = p.price;
            if (price === '0-5') return pr < 5;
            if (price === '5-10') return pr >= 5 && pr <= 10;
            if (price === '10-20') return pr > 10 && pr <= 20;
            if (price === '20+') return pr > 20;
          });
        }

        renderProducts(filtered);
      }

      // ✅ Event listeners
      document.getElementById('categoryFilter').addEventListener('change', applyFilters);
      document.getElementById('priceFilter').addEventListener('change', applyFilters);

      // ✅ Init
      hydrateUserBadge('userBadge');
      loadCategories();
      loadProducts();
      updateCartBadge();
    </script>
</body>

</html>